<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Newton Academy GPA Calculator</title>
  <style>
    /* Basic Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1, h2 {
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    input[type="text"],
    select {
      width: 100%;
      padding: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 15px;
      margin: 5px 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>GPA Calculator</h1>

  <!-- Student Name Input -->
  <div>
    <label for="studentName">Student Name:</label>
    <input type="text" id="studentName" placeholder="Enter your name">
  </div>

  <!-- Courses Table (up to 8 courses) -->
  <table id="courses-table">
    <thead>
      <tr>
        <th>Course Name</th>
        <th>Grade</th>
        <th>Course Type</th>
      </tr>
    </thead>
    <tbody id="courses-body">
      <!-- 8 rows for courses -->
      <!-- Row 1 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 2 ~ Row 8: 동일한 구조의 행을 복사하여 붙여넣습니다. -->
      <!-- (아래 7개 행도 동일하게 추가) -->
      <!-- Row 2 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 3 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 4 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 5 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 6 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 7 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
      <!-- Row 8 -->
      <tr>
        <td><input type="text" name="courseName" class="course-input" placeholder="Enter course name"></td>
        <td>
          <select name="grade" class="course-input">
            <option value="">-- Select Grade --</option>
            <option value="0.0">F</option>
            <option value="1.0">D</option>
            <option value="1.3">D+</option>
            <option value="1.7">C-</option>
            <option value="2.0">C</option>
            <option value="2.3">C+</option>
            <option value="2.7">B-</option>
            <option value="3.0">B</option>
            <option value="3.3">B+</option>
            <option value="3.7">A-</option>
            <option value="4.0">A</option>
            <option value="4.0">A+</option>
          </select>
        </td>
        <td>
          <select name="courseType" class="course-input">
            <option value="ordinary">Ordinary</option>
            <option value="honors">Honors</option>
            <option value="ap">AP</option>
          </select>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Buttons -->
  <button id="calculate">Calculate GPA</button>
  <button id="saveData">Save Data</button>
  <h2 id="result"></h2>

  <script>
    // Extra points based on course type (AP: +0.5, Honors: +0.25, Ordinary: +0.0)
    const extraPoints = {
      'ap': 0.5,
      'honors': 0.25,
      'ordinary': 0.0
    };

    // GPA calculation function
    function calculateGPA() {
      const rows = document.querySelectorAll('#courses-body tr');
      let totalPoints = 0;
      let courseCount = 0;
      let courses = [];

      rows.forEach(row => {
        const courseName = row.querySelector('input[name="courseName"]').value.trim();
        const gradeSelect = row.querySelector('select[name="grade"]');
        const courseTypeSelect = row.querySelector('select[name="courseType"]');
        const gradeValue = gradeSelect.value;
        const courseType = courseTypeSelect.value;

        if (courseName !== "" && gradeValue !== "") {
          let baseGrade = parseFloat(gradeValue);
          let extra = extraPoints[courseType] || 0;
          let finalGrade = baseGrade + extra;
          totalPoints += finalGrade;
          courseCount++;
          courses.push({ courseName, grade: gradeValue, courseType, finalGrade });
        }
      });

      if (courseCount === 0) {
        document.getElementById('result').textContent = "Please enter course information.";
        return;
      }

      let gpa = (totalPoints / courseCount).toFixed(2);
      document.getElementById('result').textContent = `GPA: ${gpa}`;

      const calcLog = {
        timestamp: new Date().toISOString(),
        studentName: document.getElementById('studentName').value,
        gpa: gpa,
        courses: courses
      };

      fetch('/submit-calculation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(calcLog)
      })
      .then(response => {
        if (!response.ok) {
          console.error("Error submitting calculation data.");
        }
      })
      .catch(err => console.error(err));
    }

    function saveData() {
      const studentName = document.getElementById('studentName').value;
      const rows = document.querySelectorAll('#courses-body tr');
      let coursesData = [];
      rows.forEach(row => {
        const courseName = row.querySelector('input[name="courseName"]').value;
        const grade = row.querySelector('select[name="grade"]').value;
        const courseType = row.querySelector('select[name="courseType"]').value;
        coursesData.push({ courseName, grade, courseType });
      });

      const data = {
        studentName: studentName,
        courses: coursesData,
        timestamp: new Date().toISOString()
      };

      localStorage.setItem('gpaData', JSON.stringify(data));
      alert('Data has been saved locally!');
    }

    function loadData() {
      const storedData = localStorage.getItem('gpaData');
      if (storedData) {
        const data = JSON.parse(storedData);
        document.getElementById('studentName').value = data.studentName;
        const rows = document.querySelectorAll('#courses-body tr');
        data.courses.forEach((course, index) => {
          if (index < rows.length) {
            rows[index].querySelector('input[name="courseName"]').value = course.courseName;
            rows[index].querySelector('select[name="grade"]').value = course.grade;
            rows[index].querySelector('select[name="courseType"]').value = course.courseType;
          }
        });
      }
    }

    document.getElementById('calculate').addEventListener('click', calculateGPA);
    document.getElementById('saveData').addEventListener('click', saveData);
    window.onload = loadData;
  </script>
</body>
</html>